{
  "metadata": {
    "project": "Media Center Arti Marziali",
    "created_at": "2026-01-21T18:00:00Z",
    "last_updated": "2026-01-21T18:00:00Z",
    "version": "1.0.0",
    "purpose": "AI-First error tracking per manutenzione automatica",
    "session": "Fix Scheduler APScheduler, Database Migration, Flutter Analyze, Test Coverage"
  },

  "errors": [
    {
      "id": "ERR-001",
      "date": "2026-01-21",
      "category": "APScheduler",
      "subcategory": "Deprecation",
      "severity": "CRITICAL",
      "title": "APScheduler add_listener() parametro deprecato",
      "symptom": "Scheduler non parte, errore su parametro events",
      "root_cause": "APScheduler 3.x ha deprecato parametro 'events=' in add_listener(), richiede 'mask=' con costanti EVENT_*",
      "error_message": "TypeError: add_listener() got an unexpected keyword argument 'events'",
      "files_affected": [
        "modules/scheduler/scheduler_service.py"
      ],
      "solution": {
        "description": "Usare mask= con costanti EVENT_JOB_EXECUTED, EVENT_JOB_ERROR",
        "code_changes": [
          {
            "file": "modules/scheduler/scheduler_service.py",
            "before": "self._scheduler.add_listener(self._on_job_executed, events=1)",
            "after": "from apscheduler.events import EVENT_JOB_EXECUTED, EVENT_JOB_ERROR\nself._scheduler.add_listener(self._on_job_executed, mask=EVENT_JOB_EXECUTED)"
          }
        ]
      },
      "prevention": "Controllare changelog APScheduler prima di upgrade, cercare deprecation warnings",
      "result": "[OK] Scheduler started with 6 jobs",
      "time_to_debug": "30 minuti",
      "time_saved_future": "30 minuti"
    },
    {
      "id": "ERR-002",
      "date": "2026-01-21",
      "category": "Database",
      "subcategory": "Schema Migration",
      "severity": "HIGH",
      "title": "Colonna event_type mancante in live_events",
      "symptom": "Live API endpoints ritornano 500, errore colonna non esiste",
      "root_cause": "Tabella live_events non aveva colonna event_type richiesta dal model",
      "error_message": "ProgrammingError: column 'event_type' does not exist",
      "files_affected": [
        "fix_event_type.py",
        "modules/live/models.py"
      ],
      "solution": {
        "description": "Creare ed eseguire script di migrazione",
        "sql": "ALTER TABLE live_events ADD COLUMN IF NOT EXISTS event_type VARCHAR(50) DEFAULT 'seminar';"
      },
      "prevention": "Usare Alembic per migrazioni automatiche, mai modificare model senza migrazione",
      "time_to_debug": "20 minuti"
    },
    {
      "id": "ERR-003",
      "date": "2026-01-21",
      "category": "Flutter",
      "subcategory": "Analyze Errors",
      "severity": "MEDIUM",
      "title": "205 errori Flutter analyze nel presentation layer",
      "symptom": "flutter analyze mostra 205 errori, principalmente in pages e widgets",
      "root_cause": "Mismatch tra BLoC events/states e usage nel presentation layer",
      "error_patterns": [
        "Event naming: LoadEventsEvent vs LoadEvents",
        "Entity types: Event vs EventEntity",
        "Missing state properties: isLoading, errorMessage",
        "Deprecated API: Color.withValues()",
        "Profile/Notifications pattern mismatches"
      ],
      "files_affected": [
        "lib/features/events/presentation/pages/*",
        "lib/features/profile/presentation/pages/*",
        "lib/features/notifications/presentation/pages/*",
        "lib/features/player/presentation/widgets/*"
      ],
      "solution": {
        "description": "Fix sistematico per modulo, allineare naming conventions",
        "fixes_applied": [
          "connectivity_service.dart - API mismatch connectivity_plus",
          "offline_queue.dart - dynamic type handling",
          "injection.dart - MarkAllReadUseCase, sharedPreferences, FusionBloc",
          "BLoC exports aggiornati in tutti i moduli",
          "event_usecases.dart - riallineato con repository",
          "profile_usecases.dart - riallineato con repository"
        ]
      },
      "progress": {"before": 275, "after": 205, "fixed": 70},
      "time_to_complete": "2-3 ore stimate per rimanenti"
    },
    {
      "id": "ERR-004",
      "date": "2026-01-21",
      "category": "Testing",
      "subcategory": "Async Fixtures",
      "severity": "HIGH",
      "title": "Test errors da async fixture mismatch",
      "symptom": "59 errors nei test, 35 failed",
      "root_cause": "Mismatch tra api_client sync e async_client nelle fixtures",
      "files_affected": [
        "tests/conftest.py",
        "tests/api/*.py"
      ],
      "solution": {
        "description": "Unificare pattern fixture async in tutti i test",
        "status": "PENDING - da completare in sessione successiva"
      },
      "statistics": {
        "passed": 349,
        "failed": 35,
        "skipped": 44,
        "errors": 59,
        "pass_rate": "90.9%",
        "target": "95%"
      }
    }
  ],

  "completed_today": [
    {
      "task": "APScheduler Fix",
      "result": "Scheduler started with 6 jobs"
    },
    {
      "task": "Database Migration event_type",
      "result": "Live API funzionanti"
    },
    {
      "task": "Flutter Skeleton 75 Integration",
      "file": "flutter_app/test/features/player/widgets/skeleton_overlay_75_test.dart",
      "result": "35/35 test passati (100%)"
    },
    {
      "task": "Nuovi Test Backend",
      "files": [
        {"name": "test_auth_api.py", "tests": 21},
        {"name": "test_users_api.py", "tests": 16},
        {"name": "test_videos_api.py", "tests": 30},
        {"name": "test_scheduler_api.py", "tests": 29},
        {"name": "test_notifications_api.py", "tests": 36}
      ],
      "total_new_tests": 132
    },
    {
      "task": "Flutter Analyze Partial Fix",
      "progress": "275 â†’ 205 errori (-70)"
    }
  ],

  "patterns_learned": [
    {
      "id": "PATTERN-001",
      "category": "APScheduler",
      "title": "Listener con mask",
      "rule": "In APScheduler 3.x usare mask= con costanti EVENT_*, non events= con interi"
    },
    {
      "id": "PATTERN-002",
      "category": "Flutter",
      "title": "BLoC naming conventions",
      "rule": "Eventi BLoC devono avere naming consistente: LoadEvents non LoadEventsEvent"
    },
    {
      "id": "PATTERN-003",
      "category": "Testing",
      "title": "Fixture scope consistency",
      "rule": "Tutte le fixture async devono usare stesso pattern (async_sessionmaker, expire_on_commit=False)"
    }
  ],

  "statistics": {
    "session_date": "2026-01-21",
    "backend_completion": "93%",
    "flutter_completion": "85%",
    "routers_ok": "32/32",
    "new_tests_created": 132,
    "flutter_errors_fixed": 70,
    "flutter_errors_remaining": 205,
    "test_pass_rate": "90.9%"
  }
}
